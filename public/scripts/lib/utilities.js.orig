define(['jquery','globals'], function($,globals){

	function getParams(fieldName,fieldSource){
		var ret = {};
		if(fieldSource)
			if(fieldSource.length>0){
				fieldSource.forEach(function(item){
					if(item.name)
						if(item.name.indexOf(fieldName.toUpperCase())>=0||(item.type ? item.type.indexOf(fieldName.toUpperCase())>=0 : false)) {
							// Item found
							ret = item;
							return;
						}
				});
			}
		return ret;
	}

	function querystring(name) {
	    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
	    var regex = new RegExp("[\\?&]" + name.toLowerCase() + "=([^&#]*)"),
	        results = regex.exec(location.search.toLowerCase());
	    return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
	}


<<<<<<< HEAD
	
=======
	function getpixel(PAGETYPE,visitor){
		var ret = "";
		//<!--pixelcode start--><img src='https://secure1.m57media.com/clients/p2c/u/pc/?cid1=0&cid2=19694&cid3=0&cid4=0&caid=30373&caCode=DEFAULT&stID=429&eType=2&misc1=&misc2=&misc3=' style='height:1px;width:1px;border-width:0px;position:absolute'/><!--pixelcode end-->
		var c = visitor.campaignInfo;
		var eType;
		switch (PAGETYPE){
			case "start" :
				eType = 2;
			break;
			case "order" : 
				eType = 3
			break;
		}
		if(c&&eType)
			ret = "<!--pixelcode start--><img src='https://secure1.m57media.com/clients/p2c/?cid1=0" 
				  + "&cid2=" + c.landingPageId + "&cid3=0&cid4=0" 
				  + "&caid=" + c.campaignId 
				  + "&caCode=" + c.campaignCode  
				  + "&stID=" + c.storeId 
				  + "&eType=" + eType 
				  + "&misc1=" + c.misc1.replace("'", "")
				  + "&misc2=" + c.misc2.replace("'", "")
				  + "&misc3=" + c.misc3.replace("'", "")
				  + "style='height:1px;width:1px;border-width:0px;position:absolute'/><!--pixelcode end-->";
		return ret;
	}
>>>>>>> origin/master


	return {
		getParams : getParams,
		querystring : querystring,
		getpixel : getpixel,
		log : function(message){
			if(globals.DEBUG){
				console.log('DEBUG : ' + message);
			}
		}

	}
});
